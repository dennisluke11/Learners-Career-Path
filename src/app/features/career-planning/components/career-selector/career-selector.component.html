<section class="career-selector-container" aria-labelledby="career-heading">
  <h2 id="career-heading">Select Your Desired Career</h2>
  
  <div *ngIf="loading" class="loading-message" role="status" aria-live="polite" aria-busy="true">
    <p>Loading careers from database...</p>
  </div>
  
  <div *ngIf="error" class="error-message" role="alert" aria-live="assertive">
    <p>{{ error }}</p>
  </div>
  
  <div *ngIf="!loading && !error" class="careers-info" role="status" aria-live="polite">
    <p class="careers-count">{{ careers.length }} career{{ careers.length !== 1 ? 's' : '' }} available</p>
  </div>
  
  <div class="select-wrapper" [class.disabled]="loading || careers.length === 0">
    <select 
      (change)="onSelectCareer($event)" 
      class="career-select"
      [disabled]="loading || careers.length === 0"
      aria-label="Select your desired career"
      aria-required="true"
      [attr.aria-busy]="loading">
      <option value="" disabled selected>
        {{ loading ? 'Loading...' : careers.length === 0 ? 'No careers available' : 'Select Desired Career' }}
      </option>
      <option *ngFor="let career of careers" [value]="career.name">
        {{ career.name }}<span *ngIf="career.category"> ({{ career.category }})</span>
      </option>
    </select>
  </div>
  
  <div *ngIf="selectedCareer" class="selected-career-info">
    <h3>Selected: {{selectedCareer.name}}</h3>
    <div *ngIf="selectedCountry" class="country-badge" aria-label="Country context">
      <span aria-hidden="true">{{selectedCountry.flag}}</span>
      <span>Requirements for {{selectedCountry.name}}</span>
    </div>
    <div class="requirements">
      <h4>Minimum Requirements:</h4>
      <div *ngIf="!selectedCareer.minGrades || getObjectKeys(selectedCareer.minGrades).length === 0" class="no-requirements">
        <p>No specific requirements available for this career.</p>
        <p class="info-text">Please check with the institution for admission requirements.</p>
      </div>
      <ul *ngIf="displayRequirements && getObjectKeys(displayRequirements).length > 0">
        <li *ngFor="let subject of getObjectKeys(displayRequirements)">
          <span class="subject-name">{{subject}}:</span>
          <span class="grade-required">{{displayRequirements[subject]}}%</span>
          <span *ngIf="subject.includes(' OR ')" class="either-or-note">(Either one required)</span>
        </li>
      </ul>
      
      <!-- Show note for either/or subjects (backend-driven) -->
      <div *ngIf="hasEitherOrSubjects()" class="either-or-info">
        <p class="info-note">
          <strong>Note:</strong> You only need to meet the requirement for <strong>one</strong> of the subjects in each "OR" pair.
        </p>
      </div>
      
      <!-- Show qualification levels if available -->
      <div *ngIf="displayQualificationLevels && displayQualificationLevels.length > 0" class="qualification-levels">
        <h5>Qualification Levels:</h5>
        <div *ngFor="let level of displayQualificationLevels" class="qual-level">
          <h6>{{level.level}} (NQF {{level.nqfLevel}})</h6>
          <ul *ngIf="level.minGrades && getObjectKeys(level.minGrades).length > 0">
            <li *ngFor="let subject of getObjectKeys(level.minGrades)">
              <span class="subject-name">{{subject}}:</span>
              <span class="grade-required">{{level.minGrades[subject]}}%</span>
              <span *ngIf="subject.includes(' OR ')" class="either-or-note">(Either one required)</span>
            </li>
          </ul>
          <div *ngIf="level.aps" class="aps-requirement">
            <span class="aps-label">Admission Point Score (APS):</span>
            <span class="aps-value">{{level.aps}}</span>
          </div>
          <p *ngIf="level.notes" class="level-notes">{{level.notes}}</p>
          
          <!-- University Dialog Button - Bottom Right -->
          <div class="qual-level-footer">
            <button 
              *ngIf="hasUniversitySources(level)"
              class="view-universities-btn"
              (click)="openUniversityDialog(level)"
              [attr.aria-label]="'View universities offering ' + (selectedCareer ? selectedCareer.name : '') + ' at ' + level.level + ' level'">
              <span aria-hidden="true">üèõÔ∏è</span> View Universities
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- University Dialog -->
<app-university-dialog
  *ngIf="selectedCareer && selectedQualificationLevel"
  [career]="selectedCareer"
  [qualificationLevel]="selectedQualificationLevel"
  [grades]="grades"
  [countryCode]="selectedCountry?.code || 'ZA'"
  [isOpen]="showUniversityDialog"
  (closeDialog)="closeUniversityDialog()">
</app-university-dialog>

